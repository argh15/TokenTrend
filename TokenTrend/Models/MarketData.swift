//
//  MarketData.swift
//  TokenTrend
//
//  Created by Arghadeep Chakraborty on 4/11/24.
//

import Foundation

// Gecko - Market Data API
/*
 URL: https://api.coingecko.com/api/v3/global
 
 JSON Response:
 "data": {
         "active_cryptocurrencies": 13802,
         "upcoming_icos": 0,
         "ongoing_icos": 49,
         "ended_icos": 3376,
         "markets": 1050,
         "total_market_cap": {
             "btc": 39147736.49046334,
             "eth": 775717193.598662,
             "ltc": 28453666200.332848,
             "bch": 4488813937.338827,
             "bnb": 4517073946.397719,
             "eos": 2592066597715.6484,
             "xrp": 4459967040890.745,
             "xlm": 21214391108045.62,
             "link": 158744669391.8377,
             "dot": 329781065660.4872,
             "yfi": 328692172.1657179,
             "usd": 2759686453393.849,
             "aed": 10134230981611.014,
             "ars": 2387996703575272.5,
             "aud": 4229807303040.6562,
             "bdt": 303226187106073.7,
             "bhd": 1040227932682.9183,
             "bmd": 2759686453393.849,
             "brl": 13984987071218.666,
             "cad": 3774326573280.8984,
             "chf": 2518346353671.651,
             "clp": 2.616155160952837e+15,
             "cny": 19967435364885.848,
             "czk": 65323155435372.58,
             "dkk": 19160227077268.152,
             "eur": 2568495375902.723,
             "gbp": 2200005482526.8584,
             "gel": 7395959695095.535,
             "hkd": 21627400565034.516,
             "huf": 1004562597702369.2,
             "idr": 4.403907642325902e+16,
             "ils": 10355011417255.46,
             "inr": 230101690593720.44,
             "jpy": 422020451398635.2,
             "krw": 3762690827256547.5,
             "kwd": 848796762470.3463,
             "lkr": 825126564721290.9,
             "mmk": 5.801528128908349e+15,
             "mxn": 45365381732760.02,
             "myr": 13102988521027.547,
             "ngn": 3.483677853123906e+15,
             "nok": 29893213430239.793,
             "nzd": 4608734330583.249,
             "php": 155729109324701.38,
             "pkr": 767533012313539.8,
             "pln": 10954768554798.633,
             "rub": 256798312290324.53,
             "sar": 10351939886232.814,
             "sek": 29563422619999.855,
             "sgd": 3733038904251.6763,
             "thb": 101043639990005.19,
             "try": 89092340377826.73,
             "twd": 88946902142046.42,
             "uah": 107509251428246.2,
             "vef": 276327404578.3264,
             "vnd": 6.8983548091254984e+16,
             "zar": 51699963258193.83,
             "xdr": 2083392171752.2483,
             "xag": 98692762449.07149,
             "xau": 1178358518.7346385,
             "bits": 39147736490463.336,
             "sats": 3.914773649046334e+15
         },
         "total_volume": {
             "btc": 1608932.8483521764,
             "eth": 31881201.461455945,
             "ltc": 1169417246.305311,
             "bch": 184485767.02984822,
             "bnb": 185647225.16116717,
             "eos": 106531346842.9299,
             "xrp": 183300188413.32617,
             "xlm": 871890274418.2883,
             "link": 6524247274.106219,
             "dot": 13553672239.389894,
             "yfi": 13508919.804915987,
             "usd": 113420355404.18877,
             "aed": 416506765929.47754,
             "ars": 98144278126397.92,
             "aud": 173840853192.62076,
             "bdt": 12462293267821.34,
             "bhd": 42752328504.98875,
             "bmd": 113420355404.18877,
             "brl": 574768993046.2668,
             "cad": 155121050373.8698,
             "chf": 103501518483.38168,
             "clp": 107521362719616.98,
             "cny": 820641639491.4672,
             "czk": 2684716409174.4917,
             "dkk": 787466185535.7421,
             "eur": 105562593181.78656,
             "gbp": 90418026806.08696,
             "gel": 303966552483.2267,
             "hkd": 888864550368.8636,
             "huf": 41286518878634.78,
             "idr": 1809962031540043.5,
             "ils": 425580621202.5248,
             "inr": 9456949536476.867,
             "jpy": 17344618815881.91,
             "krw": 154642832840188.88,
             "kwd": 34884698711.66634,
             "lkr": 33911877238457.426,
             "mmk": 238437008472090.72,
             "mxn": 1864471854347.2932,
             "myr": 538519734038.73303,
             "ngn": 143175678428648.3,
             "nok": 1228581198875.4907,
             "nzd": 189414375352.4587,
             "php": 6400310768878.728,
             "pkr": 31544839789314.05,
             "pln": 450230040201.806,
             "rub": 10554154009541.648,
             "sar": 425454384346.9591,
             "sek": 1215027126143.6233,
             "sgd": 153424168436.66788,
             "thb": 4152792627910.804,
             "try": 3661606157111.4814,
             "twd": 3655628790961.3257,
             "uah": 4418522796759.818,
             "vef": 11356780186.621433,
             "vnd": 2835154889400569.5,
             "zar": 2124816824721.7134,
             "xdr": 85625336268.12756,
             "xag": 4056173910.2747784,
             "xau": 48429357.55403451,
             "bits": 1608932848352.1763,
             "sats": 160893284835217.62
         },
         "market_cap_percentage": {
             "btc": 50.26961904884091,
             "eth": 15.483099470963987,
             "usdt": 3.8817203621317438,
             "bnb": 3.4075979282680793,
             "sol": 2.7957864852053644,
             "xrp": 1.2342046152872936,
             "steth": 1.2178576131353096,
             "usdc": 1.1655861195159982,
             "doge": 1.0210019209557462,
             "ton": 0.9408192895331494
         },
         "market_cap_change_percentage_24h_usd": 1.76018141402385,
         "updated_at": 1712814412
     }
 */


// MARK: - GlobalData
struct GlobalData: Codable {
    let data: MarketData?
}

// MARK: - MarketData
struct MarketData: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
    let marketCapChangePercentage24HUsd: Double
    
    var marketCap: String {
        if let item = totalMarketCap.first(where: { $0.key == "usd" }) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var volume: String {
        if let item = totalVolume.first(where: { $0.key == "usd" }) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var btcDominance: String {
        if let item = marketCapPercentage.first(where: { $0.key == "btc" }) {
            return item.value.asPercentageString()
        }
        return ""
    }
}


